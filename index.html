<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Amigo Secreto - Sorteio de Natal Fam√≠lia Gomes</title>
<style>
/* ---------- RESET ---------- */
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
    background: linear-gradient(#1a1a1a, #07101a);
    color: #fff;
    position: relative;
    padding: 0 10px;
}

/* ---------- HEADER ---------- */
header {
    text-align: center;
    padding: 50px 5% 30px 5%;
    position: relative;
}

header h1 {
    font-size: clamp(2rem, 8vw, 4rem);
    color: #ffdd57;
    margin-bottom: 10px;
    text-shadow: 2px 2px 10px #000;
}

header h2 {
    font-size: clamp(1rem, 4vw, 1.75rem);
    color: #fff;
    text-shadow: 1px 1px 5px #000;
}

/* ---------- INPUT & BOT√ÉO ---------- */
#inputSection {
    text-align: center;
    margin-top: 30px;
}

input {
    padding: 1em 1.5em;
    width: 90%;
    max-width: 400px;
    font-size: 1rem;
    border-radius: 30px;
    border: none;
    margin-bottom: 15px;
    outline: none;
    background: rgba(255,255,255,0.2);
    color: #fff;
    text-align: center;
    transition: background 0.3s ease;
}

input::placeholder { color: #fffb; }

input:focus { background: rgba(255,255,255,0.35); }

button {
    padding: 0.8em 2em;
    font-size: 1rem;
    border-radius: 30px;
    border: none;
    cursor: pointer;
    background: linear-gradient(45deg, #e74c3c, #ff6347);
    color: #fff;
    font-weight: bold;
    transition: transform 0.2s ease, box-shadow 0.3s ease;
    width: 90%;
    max-width: 400px;
}

button:hover {
    transform: scale(1.05);
    box-shadow: 0 0 20px #ff6347;
}

/* ---------- RESULTADO ---------- */
#resultado {
    margin-top: 30px;
    font-size: clamp(1rem, 4vw, 1.75rem);
    font-weight: bold;
    color: #27ae60;
    min-height: 60px;
    text-align: center;
    padding: 0 5%;
}

#resultado span {
    display: inline-block;
    animation: bounce 0.6s ease infinite alternate;
}

/* ---------- LISTA ---------- */
#jaSorteadosLista {
    margin-top: 20px;
    font-size: 0.9rem;
    color: #ffd700;
    text-align: center;
}

/* ANIMA√á√ïES */
@keyframes bounce {
    0% { transform: translateY(0); }
    100% { transform: translateY(-10px); }
}
</style>
</head>
<body>

<header>
    <h1>üéÑ Amigo Secreto üéÑ</h1>
    <h2>Sorteio de Natal - Fam√≠lia Gomes</h2>
</header>

<div id="inputSection">
    <input id="nome" placeholder="O teu nome">
    <br>
    <button onclick="mostrarResultado()">Sortear</button>
    <div id="resultado"></div>
</div>

<footer>
    &copy; 2025 Fam√≠lia Gomes - Com ‚ù§Ô∏è e esp√≠rito natalino
</footer>


<!-- ---------------- FIREBASE ---------------- -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDSZ3ynb5hHVRnjCM0po93qwXXAM2Mi1PI",
        authDomain: "sorteio-c5139.firebaseapp.com",
        projectId: "sorteio-c5139",
        storageBucket: "sorteio-c5139.firebasestorage.app",
        messagingSenderId: "570859468364",
        appId: "1:570859468364:web:61b629d83d41faa284a6e9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.db = db;
    window.firestoreDoc = doc;
    window.firestoreGetDoc = getDoc;
    window.firestoreSetDoc = setDoc;
</script>

<!-- ---------------- SCRIPT DO SORTEIO ---------------- -->
<script>
// --- LISTA DE PARTICIPANTES ---
const participantes = [
    "Ana","Francisco","Chico","Isabel","Tiago","Beatriz",
    "Sameiro","Leonel","Margarida","Mariana","Concei√ß√£o",
    "Paulo","Rui","Sara","Mafalda","Jos√©","Maria"
];

// --- RESTRI√á√ïES ---
const restricoes = { 
    "Ana":["Francisco","Chico","Isabel"], 
    "Francisco":["Ana","Chico","Isabel"],
    "Isabel":["Francisco","Chico","Ana"], 
    "Chico":["Francisco","Ana","Isabel"], 
    "Tiago":["Leonel","Sameiro","Beatriz"],
    "Leonel":["Tiago","Sameiro","Beatriz"],
    "Sameiro":["Leonel","Tiago","Beatriz"],
    "Beatriz":["Leonel","Sameiro","Tiago"],
    "Margarida":["Mariana","Paulo","Concei√ß√£o"],
    "Mariana":["Margarida","Paulo","Concei√ß√£o"],
    "Concei√ß√£o":["Mariana","Paulo","Margarida"],
    "Paulo":["Mariana","Margarida","Concei√ß√£o"],
    "Rui":["Sara","Mafalda"],
    "Sara":["Rui","Mafalda"],
    "Mafalda":["Sara","Rui"]
};

// --- GERAR SORTEIO ---
function gerarSorteioBacktrack() {
    const resultado = {};
    const restantes = [...participantes];

    function tentar(index) {
        if(index >= participantes.length) return true;
        const pessoa = participantes[index];
        const proibidos = new Set([pessoa, ...(restricoes[pessoa]||[])]);
        const possiveis = restantes.filter(r => !proibidos.has(r));

        for (let escolhido of possiveis.sort(() => 0.5 - Math.random())) {
            resultado[pessoa] = escolhido;
            restantes.splice(restantes.indexOf(escolhido), 1);

            if(tentar(index + 1)) return true;

            delete resultado[pessoa];
            restantes.push(escolhido);
        }
        return false;
    }
    return tentar(0) ? resultado : null;
}

// --- FUN√á√ÉO PRINCIPAL ---
async function mostrarResultado(){
    const nome = document.getElementById("nome").value.trim();
    const box = document.getElementById("resultado");
    const btn = document.querySelector('#inputSection button');
    const input = document.getElementById("nome");

    if(!participantes.includes(nome)){
        box.innerHTML = "‚ùå Esse nome n√£o existe na lista!";
        return;
    }

    const ref = firestoreDoc(db, "sorteios", nome);
    const docSnap = await firestoreGetDoc(ref);

    if (docSnap.exists()) {
        const jaSorteado = docSnap.data().sorteado;
        box.innerHTML = `‚ö†Ô∏è J√° fizeste o teu sorteio!<br>O teu amigo secreto √©: <b>${jaSorteado}</b>`;
        return;
    }

    const sorteio = gerarSorteioBacktrack();
    const escolhido = sorteio[nome];

    box.innerHTML = `üëâ O teu amigo secreto √©:<br><br> üéâ <span>${escolhido}</span>`;

    await firestoreSetDoc(ref, {
        sorteado: escolhido,
        timestamp: Date.now()
    });

    input.disabled = true;
    btn.disabled = true;
}
</script>

<!-- ----------- NEVE (mantida 100% como antes) ----------- -->
<script>
(function() {
    const snowCount = 120;
    for (let i = 0; i < snowCount; i++) {
        let snow = document.createElement("div");
        snow.classList.add("snowflake");
        document.body.appendChild(snow);

        let size = Math.random() * 4 + 2 + "px";
        let left = Math.random() * 100 + "vw";
        let duration = Math.random() * 3 + 4 + "s";
        let delay = Math.random() * 5 + "s";

        snow.style.position = "fixed";
        snow.style.top = "-10px";
        snow.style.left = left;
        snow.style.width = size;
        snow.style.height = size;
        snow.style.background = "white";
        snow.style.borderRadius = "50%";
        snow.style.filter = "blur(1px)";
        snow.style.opacity = 0.8;
        snow.style.animation = `fall ${duration} linear infinite`;
        snow.style.animationDelay = delay;
    }

    const style = document.createElement("style");
    style.innerHTML = `
        @keyframes fall {
            0% { transform: translateY(0); opacity: 0.8; }
            100% { transform: translateY(100vh); opacity: 0.4; }
        }
    `;
    document.head.appendChild(style);
})();
</script>

</body>
</html>
